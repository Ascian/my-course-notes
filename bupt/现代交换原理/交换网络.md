## 交换单元的基本概念和数学模型

### 交换设备结构

* 交换单元：在入线和出线建立连接，将入线上信息发送到出现上
* 控制单元：对信号进行译码，控制交换单元动作
* 接口单元：外部线路信号与交换单元信号的转换

### 交换单元基本概念

完成交换功能的**基本部件**，能按照一定要求，将入线上的信息发送到指定的出线

### 交换单元分类

* 按照信息流向分类
  * 有向交换单元：信息只能从入线进入交换单元，从出线交换出来。M $\times$ N 有向交换单元表示 M 条入线、N 条出线
  * 无向交换单元：相当于将入线和出线合并。N 无向交换单元表示 N 个双向通信信息端
    * N 无向交换单元：相当于把 N*N 的有向交换单元相同编号的入线与出线合并
    * K * L 无向交换单元：N = K + L，只有在 K 个信息端和 L 个信息端之间进行交换，K 个信息端之间和 L 个信息端之间无法进行交换
* 按照需求分类
  * 集中型：入线数大于出线数
  * 分配型：入线数等于出线数
  * 扩散型：入线数小于出线数
* 按照交换单元内部结构分类
  * 时分交换单元：所有输入和输出端口之间共享唯一通路，可以是共享总线或共享存储器
  * 空分交换单元：所有入线与出线间存在多条通路，信息可以并行的在通路上传送

### 交换过程

* 建立内部通道，完成入线和出线的信息交换
* 完成信息交换后，拆除内部通道

### 连接特性

#### 描述方法

##### 集合描述方式


入线集合 $T={0, 1, 2...M-1}$，出线集合 $R={0, 1, 2,...N-1}$
。

对于一个入端 $t(t\in T)$ 和一组出端 $R_t(R_t \subseteq R)$, $c={t, R_t}$ 称为**一个连接**，t 称为起点，r $\in R_t$ 称为终点 


若 $R_t$ 只包含一个元素，则该连接时**点对点**的，否则为**点对多点**的

若一个交换单元允许点对多点的连接，则称具有**同发**功能；若允许对于全体出端的连接（$R_t=R$），则称具有广播功能

交换单元不允许出现多对一或多对多连接，该种情况称为**冲突**

**连接方式** C 为若干连接的集合

**起点集** $T_c$ 为该连接方式所有连接方式中所有连接的起点集合，**终点集** $R_c$ 为该连接方式中所有连接的终点集合

若 $t\in T_c$ 或 $r\in R_c$，称其为**占用**状态，否则为**空闲**状态

##### 函数表示法

* 连接函数：$f(t)=R_t$，一个连接函数表示一个连接
* 排列表达式（重排表达式）：$\left( \begin{matrix} r_1 r_2 ... r_n \\ t_1 t_2 ... t_n \end{matrix}\right)$ 表示入线 $t_i$ 连接到出线 $r_i$，对于点对多点的连接，上一行可能由重复的元素存在。
  * 当不存在同发时，上式写作$\left( \begin{matrix} 1 2 ... n \\ t_1 t_2 ... t_n \end{matrix}\right)$，简写做 $(t_1, t_2, ... t_n)$，称作**入端重排表示**
* 图形表示：把入线和出线按编号从上到下排列，用直线连接



## 各类交换单元

### 性能指标

* 容量：可交换的信息量或出入线数量
* 接口：单向/双向，数字/模拟
* 交换功能：点到点，同发，广播
* 质量：时延，内部阻塞

### 种类

#### 基本开关阵列

##### 特性

* 由空间上分离的多个开关部件构成，是一种**空分交换**单元
* 容易实现同发与广播功能：只需要将入线上相应的出线所对应的开关打开就行
* 信息从入线到出线具有均匀的单位延迟时间：任意入线到任意出线经过的开关数量是相等的
* 开关阵列的的控制简单：开关状态只有两个
* 开关阵列适合构成较小规模的交换单元：开关的数量为入线数与出线数的乘积
* 无内部阻塞

##### 缺点

* 交叉接点开关数量巨大
* 交叉接点开关利用率低

##### 实际开关阵列

* 继电器：噪声大、动作慢
* 模拟电子开关：半导体，只能单向且衰耗和延时大
* 数字电子开关：逻辑门，动作快且无损失
* 多路选择器：可有效避免冲突
* 2*2 交叉连接单元：可避免出现冲突，但不允许同发    
* 带缓冲器的开关：没有呼损，由排队延迟

##### 典型开关阵列-空间(S)接线器

###### 基本结构

* 由于交叉点矩阵与一组控制存储器组成
* 控制存储器的数量等于输入线数或输出线数 N，每个控制存储器对应一根输入线或输出线
* 控制存储器上单元的数量等于复用线上一帧的时隙数量
* 每个单元的比特数 m，满足 $2^m = N$

###### 控制方式

* 输入控制方式：控制存储器与输入线对应
![空间交换器输入控制](img/%E7%A9%BA%E9%97%B4%E6%8E%A5%E7%BA%BF%E5%99%A8%E8%BE%93%E5%85%A5%E6%8E%A7%E5%88%B6.png)
* 输出控制方式：控制存储器与输出线对应
![空间交换器输出控制](img/%E7%A9%BA%E9%97%B4%E6%8E%A5%E7%BA%BF%E5%99%A8%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6.png)


###### 特点

* 以时分方式完成复用线之间的空间交换
* 每个交叉点仅接通一个时隙
* 交换的控制过程由硬件 CM 实现，速度快
* 交换时延小，且稳定
* 严格无阻塞
* 可避免出现冲突-输出控制
* 易于实现同发和广播-输出控制


#### 共享存储器

##### 基本结构

* 信号存储器：被划为多个区域，与入线或出线的数量一致
* 控制器


##### 控制方式

* 输入缓冲方式：存储器区域与输入信号一一对应，控制输出
* 输出缓冲方式：存储器区域与输出信号一一对应，控制输入

##### 特点

* 时分交换单元，使用于三类时分复用信号
* 延迟时间不均匀
* 可以实现同发与广播
* 存储容量足够大，无内部阻塞
* 容量受到信号存储器工作速度和控制器工作速度限制

##### 典型共享存储器-时间(T)接线器

实现一条母线上的时隙交换，采用同步时分复用
###### 基本结构

* 话音存储器：存放数字编码的话音信息
* 控制存储器：存放话音存储器在当前时隙应读入或写入的地址

![时间交换器](img/%E6%97%B6%E9%97%B4%E6%8E%A5%E7%BA%BF%E5%99%A8.png)
###### 控制方式

* 输出控制
  * 话音存储器SM 顺序写入，控制读出
  * 控制存储器CM 控制写入，顺序读出
* 输出控制
  * 话音存储器SM 控制写入，顺序读出
  * 控制存储器CM 顺序写入，控制读出 

###### 特点

* 以空间位置的划分实现时隙交换
* SM 划分为 N 各区域，每个区域**一字节**各个区域间不共享且无排队缓冲
* 交换的控制过程由硬件 CM 实现，速度快
* 交换时延小，且稳定
* 严格无阻塞
* 可避免出现冲突
* 易于实现同发和广播
* 带宽固定为 **64kbit/s**

#### 总线型

##### 基本结构

* 总线
* 入线控制：暂时存储输入线上的信号，在相应时隙到来时将信号发送到总线上
* 出线控制：检测总线上的信号，将属于本端口的信息输出

##### 工作方式

* 时隙分配
  * 固定时隙分配
  * 按需时隙分配
* 令牌法
* 冲突检测

##### 特性

* 易于实现广播
* 有时延，不同工作方式时延由差别
* 交换速度与总线宽度有关
* 受总线上速率限制，不能构造大规模的交换单元

##### 典型总线型交换单元-数字交换单元 

* 内部有 16 个端口，每个端口接一条双向 32 路的 PCM 总线，512*512 交换单元
* 16 个端口与总线采用总线型交换
* 32 路信道与端口采用共享存储器交换
* 不仅能完成不同复用线上的交换，还能完成不同时隙之间的交换，同时具有空间骄交换功能和时间交换功能


![数字交换单元](img/%E6%95%B0%E5%AD%97%E4%BA%A4%E6%8D%A2%E5%8D%95%E5%85%83.png)

## 交换网络

### 参数

* 每个交换单元的容量
* 交换单元的级数
* 交换单元间的连接通路
### 交换网络分类

* 单级交换网络与多级交换网络：需要交换的信息从交换网络输入端到交换网络输出端是否要经过多个交换单元
* 有阻塞交换网络和无阻塞交换网络：是否存在内部阻塞（内部阻塞：；由内部竞争发生的阻塞，无法找到空闲通道到达空闲出线）
> 内部竞争：同时争抢交换网络内部线路
> 出线竞争：同时争抢交换网络同一个输出端口
  * 严格无阻塞网络：只要入端和出端空闲时，就可以通过交换网络建立一个连接
  * 可重排无阻塞网络：只要入端和出端空闲时，通过重新安排连接已连接线路避免阻塞，插入新连接
  * 广义无阻塞网络：一个给定的网络存在着固有的阻塞可能，但又可能存在着一种精巧的选路方法，使得阻塞可以避免，而不必重新安排网络中已建立的连接
* 单通路网络和多通路网络：入线和出线间是否存在多条通路
### 各类交换网络

#### CLOS 网络

对于一个 $N \times N$ k 级 CLOS 的交换网络，有下列关系存在：

$$ n_1 = N / i_1, o_k = n_{k+1}, i_k = n_{k-1}, n_k = N / o_k $$

![CLOS网络](img/CLOS%E7%BD%91%E7%BB%9C.png)
##### 严格无阻塞条件

充要条件：$ n_2 \geq i_1 + o_3 - 1 $ ，当网络对称，即 $i_1 = o_3 = n$，$n_2 \geq 2n - 1$

极限情况
  * 第一级与 a 相连的交换单元 i 中除去 a 之外的 n-1 条入线均有信息交换，即 i 与第二级相连的线有 n-1 条被占用
  * 第三级与 b 相连的交换单元 j 中除去 b 之外的 n-1 条出线也均有信息交换，即 j 与第二级相连的线有 n-1 条被占用
  * 在最坏的情况下，i 连接的第二级的交换单元均与 j 不同，那么 a 若要连接上 b，必须还存在一个第二级的交换单元未被使用

![CLOS网络严格无阻塞](img/CLOS%20%E6%97%A0%E9%98%BB%E5%A1%9E.png)
##### 可重排无阻塞条件

充分条件：$ n_2 \geq Max( i_1, o_3) $，当网络对称时，$ n_2 \geq n $

重排次数 $ \leq n_1 + n_2 - 2$ 

极限情况
  * 第一级与 a 相连的交换单元 i 中除去 a 之外的 n-1 条入线均有信息交换，即 i 与第二级相连的线有 n-1 条被占用
  * 第三级与 b 相连的交换单元 j 中除去 b 之外的 n-1 条出线也均有信息交换，即 j 与第二级相连的线有 n-1 条被占用
  * i 连接的第二级的交换单元均与 j 相同或包含

#### TST 网络

具有 32 条双向时分复用线，编号相同的入线和出线共同组成一条双向时分复用线。

结构：入线 -> T 接线器 -> S 接线器 -> T 接线器 -> 出线

![TST网络](img/TST%E7%BD%91%E7%BB%9C.png)
##### 注意

* 双向传输时一般采用“反向法”，即两个方向差半个帧。设 TST 交换网络输入线或输出线的帧为 F，选定的 A->B 方向的内部时隙为 TS，则 B->A 方向的内部时隙为 TS + F/2。
* TST 交换网络存在内部阻塞，但概率非常小
* 一般构成 TST 网络的第一级和第三级 T 接线器采用不同的控制方式，但除了操作方式不同，本质是一样的。

#### banyan 网络

![banyan网络](img/banyan%20%E7%BD%91%E7%BB%9C.png)
##### 基本单元

2 * 2 交叉连接单元

##### 特性

* banyan 网络基于树形网络结构：构成以某一输入端为根节点，以所有输出端为叶子结点的属性结构
* N*N banyan 网络的级数为 log$_2$N，每级有 N/2 个交换单元
* 可以使用两个 N*N banyan 网络增加一级构成 (N+1)*(N+1) banyan 网络
![banyan扩展](img/banyan%E6%89%A9%E5%B1%95.png)
* banyan 网络具有唯一路径特性
* banyan 网络具有自动选路特性：可以使用级数 k 位的二进制值进行选路（二进制值唯一指定一个输出端口，即出线地址）
* banyan 网络具有内部竞争性

##### 降低内部阻塞的方法

* 增加级数
* 引入排序网络：batcher-banyan 网络
  * 若将输入信息全部按交换的出线地址进行单调递增或递减排序可以避免内部阻塞
  * batcher 网络的每个节点比较两个连接目的地址，并将高地址送到高端（低端），低地址送到低端（高端），仅由一个连接时送到低端
![batcher-banyan](img/batcher-banyan%E7%BD%91%E7%BB%9C.png)
* 限制入线上的信息量，加大缓冲存储器
* 增加 banyan 网络的平面数，构成多通道交换网络
